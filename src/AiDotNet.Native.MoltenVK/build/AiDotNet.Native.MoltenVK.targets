<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--
    This targets file copies MoltenVK native libraries to the output directory
    when a project references AiDotNet.Native.MoltenVK.
    MoltenVK provides Vulkan-to-Metal translation on macOS.
  -->

  <PropertyGroup>
    <AiDotNetNativeMoltenVKPackagePath>$(MSBuildThisFileDirectory)..</AiDotNetNativeMoltenVKPackagePath>
  </PropertyGroup>

  <!-- macOS x64 (Intel) -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'osx-x64' Or ('$(RuntimeIdentifier)' == '' And $([MSBuild]::IsOSPlatform('OSX')) And '$(PlatformTarget)' != 'ARM64')">
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\libvulkan.1.dylib"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\libvulkan.1.dylib')">
      <Link>libvulkan.1.dylib</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\libMoltenVK.dylib"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\libMoltenVK.dylib')">
      <Link>libMoltenVK.dylib</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\MoltenVK_icd.json"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-x64\native\MoltenVK_icd.json')">
      <Link>MoltenVK_icd.json</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- macOS arm64 (Apple Silicon) -->
  <ItemGroup Condition="'$(RuntimeIdentifier)' == 'osx-arm64' Or ('$(RuntimeIdentifier)' == '' And $([MSBuild]::IsOSPlatform('OSX')) And '$(PlatformTarget)' == 'ARM64')">
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\libvulkan.1.dylib"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\libvulkan.1.dylib')">
      <Link>libvulkan.1.dylib</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\libMoltenVK.dylib"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\libMoltenVK.dylib')">
      <Link>libMoltenVK.dylib</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
    <Content Include="$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\MoltenVK_icd.json"
             Condition="Exists('$(AiDotNetNativeMoltenVKPackagePath)\runtimes\osx-arm64\native\MoltenVK_icd.json')">
      <Link>MoltenVK_icd.json</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

</Project>
